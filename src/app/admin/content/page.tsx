\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useAppSelector } from \"@/lib/hooks/redux\";\nimport { useRouter } from \"next/navigation\";\nimport { Plus, Edit, Trash2, Save, X } from \"lucide-react\";\nimport { websiteService, WebsiteContent } from \"@/lib/services/website.service\";\n\nexport default function AdminContentPage() {\n  const { user, isAuthenticated } = useAppSelector((state) => state.auth);\n  const router = useRouter();\n  const [content, setContent] = useState<WebsiteContent[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editValue, setEditValue] = useState<any>(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [newContent, setNewContent] = useState({\n    section: \"hero\",\n    type: \"text\",\n    key: \"\",\n    value: \"\",\n    order: 0\n  });\n\n  useEffect(() => {\n    if (!isAuthenticated || (user?.role !== 'ADMIN' && user?.role !== 'SUPER_ADMIN')) {\n      router.push('/');\n      return;\n    }\n    fetchContent();\n  }, [isAuthenticated, user, router]);\n\n  const fetchContent = async () => {\n    try {\n      setLoading(true);\n      const data = await websiteService.getAllContent();\n      setContent(data);\n    } catch (error) {\n      console.error('Failed to fetch content:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (item: WebsiteContent) => {\n    setEditingId(item._id!);\n    setEditValue(typeof item.value === 'object' ? JSON.stringify(item.value, null, 2) : item.value);\n  };\n\n  const handleSave = async (id: string) => {\n    try {\n      let parsedValue = editValue;\n      const item = content.find(c => c._id === id);\n      \n      if (item?.type === 'object' || item?.type === 'array') {\n        try {\n          parsedValue = JSON.parse(editValue);\n        } catch (e) {\n          alert('Invalid JSON format');\n          return;\n        }\n      }\n      \n      await websiteService.updateContent(id, { value: parsedValue });\n      setEditingId(null);\n      fetchContent();\n    } catch (error) {\n      console.error('Failed to update content:', error);\n      alert('Failed to update content');\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm('Are you sure you want to delete this content?')) {\n      try {\n        await websiteService.deleteContent(id);\n        fetchContent();\n      } catch (error) {\n        console.error('Failed to delete content:', error);\n        alert('Failed to delete content');\n      }\n    }\n  };\n\n  const handleAdd = async () => {\n    try {\n      let parsedValue = newContent.value;\n      \n      if (newContent.type === 'object' || newContent.type === 'array') {\n        try {\n          parsedValue = JSON.parse(newContent.value);\n        } catch (e) {\n          alert('Invalid JSON format');\n          return;\n        }\n      }\n      \n      await websiteService.createContent({\n        ...newContent,\n        value: parsedValue\n      });\n      \n      setShowAddForm(false);\n      setNewContent({ section: \"hero\", type: \"text\", key: \"\", value: \"\", order: 0 });\n      fetchContent();\n    } catch (error) {\n      console.error('Failed to create content:', error);\n      alert('Failed to create content');\n    }\n  };\n\n  const seedContent = async () => {\n    try {\n      await websiteService.seedDefaultContent();\n      fetchContent();\n      alert('Default content seeded successfully!');\n    } catch (error) {\n      console.error('Failed to seed content:', error);\n      alert('Failed to seed content');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-black\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Website Content Management</h1>\n            <p className=\"text-gray-600 mt-2\">Manage dynamic website content</p>\n          </div>\n          <div className=\"flex gap-4\">\n            <button\n              onClick={seedContent}\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\n            >\n              Seed Default Content\n            </button>\n            <button\n              onClick={() => setShowAddForm(true)}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\"\n            >\n              <Plus size={20} />\n              Add Content\n            </button>\n          </div>\n        </div>\n\n        {showAddForm && (\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n            <h3 className=\"text-lg font-semibold mb-4\">Add New Content</h3>\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Section</label>\n                <select\n                  value={newContent.section}\n                  onChange={(e) => setNewContent({...newContent, section: e.target.value})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"hero\">Hero</option>\n                  <option value=\"brands\">Brands</option>\n                  <option value=\"new-arrivals\">New Arrivals</option>\n                  <option value=\"top-selling\">Top Selling</option>\n                  <option value=\"dress-style\">Dress Style</option>\n                  <option value=\"reviews\">Reviews</option>\n                  <option value=\"footer\">Footer</option>\n                  <option value=\"about\">About</option>\n                  <option value=\"contact\">Contact</option>\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Type</label>\n                <select\n                  value={newContent.type}\n                  onChange={(e) => setNewContent({...newContent, type: e.target.value})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"text\">Text</option>\n                  <option value=\"image\">Image</option>\n                  <option value=\"list\">List</option>\n                  <option value=\"object\">Object</option>\n                  <option value=\"array\">Array</option>\n                </select>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Key</label>\n                <input\n                  type=\"text\"\n                  value={newContent.key}\n                  onChange={(e) => setNewContent({...newContent, key: e.target.value})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"content-key\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Order</label>\n                <input\n                  type=\"number\"\n                  value={newContent.order}\n                  onChange={(e) => setNewContent({...newContent, order: parseInt(e.target.value)})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n              </div>\n            </div>\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Value</label>\n              <textarea\n                value={newContent.value}\n                onChange={(e) => setNewContent({...newContent, value: e.target.value})}\n                rows={4}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                placeholder={newContent.type === 'object' || newContent.type === 'array' ? 'Enter JSON format' : 'Enter content value'}\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <button\n                onClick={handleAdd}\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2\"\n              >\n                <Save size={16} />\n                Save\n              </button>\n              <button\n                onClick={() => setShowAddForm(false)}\n                className=\"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center gap-2\"\n              >\n                <X size={16} />\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Section</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Key</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Value</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Order</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {content.map((item) => (\n                  <tr key={item._id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                      {item.section}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {item.key}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <span className=\"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full\">\n                        {item.type}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900 max-w-xs\">\n                      {editingId === item._id ? (\n                        <textarea\n                          value={editValue}\n                          onChange={(e) => setEditValue(e.target.value)}\n                          rows={3}\n                          className=\"w-full px-2 py-1 border border-gray-300 rounded text-xs\"\n                        />\n                      ) : (\n                        <div className=\"truncate max-w-xs\" title={typeof item.value === 'object' ? JSON.stringify(item.value) : item.value}>\n                          {typeof item.value === 'object' ? JSON.stringify(item.value) : item.value}\n                        </div>\n                      )}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {item.order}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n                        item.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n                      }`}>\n                        {item.isActive ? 'Active' : 'Inactive'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                      <div className=\"flex items-center space-x-2\">\n                        {editingId === item._id ? (\n                          <>\n                            <button\n                              onClick={() => handleSave(item._id!)}\n                              className=\"text-green-600 hover:text-green-900\"\n                            >\n                              <Save size={16} />\n                            </button>\n                            <button\n                              onClick={() => setEditingId(null)}\n                              className=\"text-gray-600 hover:text-gray-900\"\n                            >\n                              <X size={16} />\n                            </button>\n                          </>\n                        ) : (\n                          <>\n                            <button\n                              onClick={() => handleEdit(item)}\n                              className=\"text-blue-600 hover:text-blue-900\"\n                            >\n                              <Edit size={16} />\n                            </button>\n                            <button\n                              onClick={() => handleDelete(item._id!)}\n                              className=\"text-red-600 hover:text-red-900\"\n                            >\n                              <Trash2 size={16} />\n                            </button>\n                          </>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}